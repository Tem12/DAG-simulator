# DAG-Sword: A Simulator of Large-Scale Network Topologies for DAG-Oriented Proof-of-Work Blockchains
Purpose of this simulator is to simulate realistic network topology of DAG-based consensus protocols while capturing information on minersâ€™ profits and transaction throughput of the network and study study malicious behaviors as part of incentive-oriented attacks.

## Overview
We propose a simulator for DAG-oriented consensus protocols to simulate large-scale blockchain networks with topology resembling Bitcoin network.
Our simulator focuses on obtaining knowledge about miners' profits, network transaction throughput (i.e., the number of processed transactions per second), and the transaction collision rate (i.e., the number of transactions that are duplicates and thus do not contribute to the throughput). 
A miner that produces a block is rewarded from two sources: the block reward and transaction fees. The value of the block reward is deterministic and is known during mining. 
The reward from transaction fees is simply the sum of all the transaction fees in the block.
The most well-known DAG-protocols that aim at maximizing the transactional throughput (i.e., [PHANTOM & GHOSTDAG](https://doi.org/10.1145/3479722.3480990), and [Spectre](https://eprint.iacr.org/2016/1159)) propose to select transactions into block *randomly* (not necessarily uniformly at random) to avoid potential transaction collision in favor the throughput.
However, greedy miners in anonymous permissionless systems such as blockchain (without a possibility to punish misbehavior) might violate this rule and select transactions based on the fees (greedily) and thus attempt to maximize their profits.
Therefore, the incentive strategy of the protocol impacts the properties of DAG protocols, such as fair distribution of rewards and throughput.

For more information, please refer to original paper: [https://arxiv.org/abs/2311.04638](https://arxiv.org/abs/2311.04638)

## Installation
To run the DAG-Sword simulator, follow these steps:

1. Clone this repository to your local machine.
    ```
    git clone https://github.com/Tem12/DAG-simulator.git
    ```

2. Enter simulator directory.
    ```
    cd DAG-simulator
    ```

3. Compile C++ implementation.
    ```bash
    make   
    ```

4. Install python 3 dependencies for post-process.
    ```bash
    pip install -r requirements.txt
    ```

## Usage

```
./dag-simulator OPTIONS
```

### Required options
| Argument | Description |
| --- | --- |
|  `--config PATH`                | input configuration file |

### Optional Options:
| Argument | Default value: | Description |
| --- | --- | --- |
|  `--help`                      | - | shows help message |
|  `--seed INT`                  | 0 | seed for random number generator |
|  `--blocks UINT`               | 1000  | number of blocks to simulate |
|  `--block_size UINT`           | 100  | number of transactions in block |
|  `--mp_capacity UINT`          | 5000  | mempool capacity for each miner |
|  `--init_tx_count UINT`        | 1000  | initial transaction count to generate on start |
|  `--max_tx_gen_count UINT`     | 100 | max number of transactions in single generation |
|  `--min_tx_gen_count UINT`     | 150 | min number of transactions in single generation |
|  `--max_tx_gen_time UINT`      | 10  | max seconds of simulation time to generate new transaction  |
|  `--min_tx_gen_time UINT`      | 20  | min seconds of simulation time to generate new transaction |
|  `--lambda UINT`               | 20  | block creation rate in seconds |
|  `--honest_random_remove`      | - | flag - honest miners remove transactions randomly on full mempool |
|  `--mp_print_data`             | - | flag - output mempool stats of all miners during simulation |

Simulation outputs are stored in directory `output/`

#### Example
Start simulation of 2000 blocks, where each block has size of 150 transactions in network inspired by Bitcoin where 2 greedy (malicious) miners have 40% of total mining power.
```
./dag-simulator --blocks 2000 --block_size 150 --config configs/btc-payoff_2h_2m-40-v1.cfg
```

## Post-process

### Collision analysis
This script requires only one argument, a path to a data file generated by simulation. It automatically parses the name and opens the metadata file to get all the required information. The produced output contains the number of unique transactions and transactions with two or more duplicates (up to five). It also outputs duplicate transactions along with the weighted sum of duplicated transactions and the duplication rate.

#### Example
```
python3 post-process/collision_analysis.py --data outputs/data_btc-payoff_2h_2m-40-v1.cfg_0000.csv
```

### Profit analysis
This script also gets all the required information from metadata. An additional required argument is the mining power threshold. This argument specifies the minimum mining power required for the miner to be analyzed separately (i.e., two greedy miners where each of them has 20% mining power). Miners below the threshold will be merged during the analysis. As an optional argument, there can be a specified reward per block.

#### Example
```
python3 post-process/profit_analysis.py --data outputs/data_btc-payoff_2h_2m-40-v1.cfg_0000.csv --power-thold 0.2
```